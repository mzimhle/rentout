<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/feature.php';require_once 'class/File.php';$featureObject 	= new class_feature();$fileObject 	= new File(array('gif', 'png', 'jpg', 'jpeg', 'gif'));if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$featureData = $featureObject->getByCode($code);		if($featureData) {		$smarty->assign('featureData', $featureData);	} else {		header('Location: /car/feature/');		exit;			}}/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	if(isset($_POST['feature_name']) && trim($_POST['feature_name']) == '') {		$errorArray['feature_name'] = 'Please add a feature name';		$formValid = false;			}		if(isset($_FILES['featureimage'])) {		/* Check validity of the CV. */		if((int)$_FILES['featureimage']['size'] != 0 && trim($_FILES['featureimage']['name']) != '') {			/* Check if its the right file. */			$ext = $featureObject->_File->file_extention($_FILES['featureimage']['name']); 			if($ext != '') {								$checkExt = $featureObject->_File->getValidateExtention('featureimage', $ext);								if(!$checkExt) {					$errorArray['featureimage'] = 'Invalid file type something funny with the file format';					$formValid = false;										}			} else {				$errorArray['featureimage'] = 'Invalid file type';				$formValid = false;												}		} else {						switch((int)$_FILES['featureimage']['error']) {				case 1 : $errorArray['featureimage'] = 'The uploaded file exceeds the maximum upload file size, should be less than 1M'; $formValid = false; break;				case 2 : $errorArray['featureimage'] = 'File size exceeds the maximum file size'; $formValid = false; break;				case 3 : $errorArray['featureimage'] = 'File was only partically uploaded, please try again'; $formValid = false; break;				case 4 : $errorArray['featureimage'] = 'No file was uploaded'; $formValid = false; break;				case 6 : $errorArray['featureimage'] = 'Missing a temporary folder'; $formValid = false; break;				case 7 : $errorArray['featureimage'] = 'Faild to write file to disk'; $formValid = false; break;			}		}	}	if(count($errorArray) == 0 && $formValid == true) {				$data 	= array();					$data['feature_name']		= trim($_POST['feature_name']);										if(isset($_FILES['featureimage']) && (int)$_FILES['featureimage']['size'] != 0 && trim($_FILES['featureimage']['name']) != '') {						$ext 			= strtolower($featureObject->_File->file_extention($_FILES['featureimage']['name']));								$filename	= $featureObject->_File->getRandomFileName().'.'.$ext;			$directory	= realpath(__DIR__.'/../../../public_html/').'/media/feature/';			$file			= $directory.$filename;				if(!is_dir($directory)) mkdir($directory, 0777, true);			if(file_put_contents($file, file_get_contents($_FILES['featureimage']['tmp_name']))) {				$data['feature_icon']			= '/media/feature/'.$filename;				$success	= $featureObject->insert($data);									header('Location: /car/feature/');				exit;			} else {				$errorArray['featureimage'] = 'We could not upload the image, please try again.';				$formValid = false;						}		}	}		/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);}$smarty->display('car/feature/details.tpl');?>