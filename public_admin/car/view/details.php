<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/car.php';require_once 'class/brand.php';require_once 'class/make.php';require_once 'class/model.php';require_once 'class/group.php';require_once 'class/File.php';$carObject 			= new class_car();$brandObject 		= new class_brand();$makeObject 		= new class_make();$modelObject 		= new class_model();$groupObject 		= new class_group();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$carData = $carObject->getByCode($code);		if($carData) {		$smarty->assign('carData', $carData);	} else {		header('Location: /car/view/');		exit;			}}if(isset($_GET['get_make_code'])) {	$errorArray				= array();	$errorArray['error']	= '';	$errorArray['result']	= 0;		$formValid				= true;	$success				= NULL;	$brandcode				= trim($_GET['get_make_code']);	$html 					= '<select id="make_code" name="make_code" onchange="getModel();"><option value=""> ----- </option>';		$makeData = $makeObject->getByBrand($brandcode);	if($makeData) {				for($i = 0; $i < count($makeData); $i++) {			$selected = isset($carData) && $carData['make_code'] == $makeData[$i]['make_code'] ? 'selected' : '';			$html	.= '<option value="'.$makeData[$i]['make_code'].'" '.$selected.'>'.$makeData[$i]['make_name'].'</option>';				}			}	$html .= '</select>';	echo $html;	exit;}if(isset($_GET['get_model_code'])) {	$errorArray				= array();	$errorArray['error']	= '';	$errorArray['result']	= 0;		$formValid				= true;	$success				= NULL;	$makecode				= trim($_GET['get_model_code']);	$html 					= '<select id="model_code" name="model_code"><option value=""> ----- </option>';		$modelData = $modelObject->getByMake($makecode);		if($modelData) {				for($i = 0; $i < count($modelData); $i++) {			$selected = isset($carData) && $carData['model_code'] == $modelData[$i]['model_code'] ? 'selected' : '';			$html	.= '<option value="'.$modelData[$i]['model_code'].'" '.$selected.'>'.$modelData[$i]['model_name'].'</option>';				}			}	$html .= '</select>';	echo $html;	exit;}$brandpairs = $brandObject->pairs();if($brandpairs) $smarty->assign('brandpairs', $brandpairs);$grouppairs = $groupObject->pairs();if($grouppairs) $smarty->assign('grouppairs', $grouppairs);/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;		if(isset($_POST['brand_code']) && trim($_POST['brand_code']) == '') {		$errorArray['brand_code'] = 'Car brand required';		$formValid = false;			}		if(isset($_POST['group_code']) && trim($_POST['group_code']) == '') {		$errorArray['group_code'] = 'Car group for pricing is required';		$formValid = false;			}		if(isset($_POST['make_code']) && trim($_POST['make_code']) == '') {		$errorArray['make_code'] = 'Car make required';		$formValid = false;			}		if(isset($_POST['participant_code']) && trim($_POST['participant_code']) == '') {		$errorArray['participant_code'] = 'Car owner required';		$formValid = false;			}		if(isset($_POST['areapost_code']) && trim($_POST['areapost_code']) == '') {		$errorArray['areapost_code'] = "Car's location required";		$formValid = false;			}		if(isset($_POST['model_code']) && trim($_POST['model_code']) == '') {		$errorArray['model_code'] = 'Model required';		$formValid = false;			}		if(isset($_POST['car_year']) && trim($_POST['car_year']) == '') {		$errorArray['car_year'] = 'Car year the owner bought it is required';		$formValid = false;			} else {				$year = (int)trim($_POST['car_year']);				if($year >= 1900 && $year <= date('Y')) {			/* Do nothing. */		} else {			$errorArray['car_year'] = 'Year bought should be between the years 1900 and '.date('Y');			$formValid = false;		}	}		if(isset($_POST['car_description']) && trim($_POST['car_description']) == '') {		$errorArray['car_description'] = 'Description required';		$formValid = false;			}		if(count($errorArray) == 0 && $formValid == true) {				$data 	= array();			$data['participant_code']	= trim($_POST['participant_code']);									$data['model_code']			= trim($_POST['model_code']);						$data['car_year']				= trim($_POST['car_year']);									$data['car_description']		= trim($_POST['car_description']);						$data['group_code']			= trim($_POST['group_code']);				if(isset($carData)) {			/*Update. */			$where		= $carObject->getAdapter()->quoteInto('car_code = ?', $carData['car_code']);			$success	= $carObject->update($data, $where);			$success 	= $carData['car_code'];					} else {			$success = $carObject->insert($data);		}				if(count($errorArray) == 0) {			header('Location: /car/view/image.php?code='.$success);				exit;		}					}		/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('car/view/details.tpl');?>